# 项目规范 (Project Rules)

## 1. 代码风格与格式

### 1.1 Python 代码风格

-   遵循 PEP 8 规范
-   使用 4 个空格进行缩进，不使用制表符
-   行长度不超过 100 个字符
-   函数和类之间空两行，类中的方法之间空一行
-   导入顺序：标准库 > 第三方库 > 本地模块，每组之间空一行
-   使用有意义的变量名和函数名，采用小写字母和下划线命名法（snake_case）

### 1.2 文件格式

-   所有 Python 文件使用 UTF-8 编码
-   文件开头添加 shebang 行和编码声明：
    ```python
    #!/usr/bin/env python
    # -*- coding: utf-8 -*-
    ```
-   每个文件末尾保留一个空行

### 1.3 注释规范

-   每个模块、类和函数都应有文档字符串（docstring）
-   模块级文档字符串应描述模块的功能和用途
-   函数文档字符串应包含参数、返回值和异常说明
-   使用 Google 风格的文档字符串格式：

    ```python
    def function(param1, param2):
        """函数描述

        Args:
            param1: 参数1的描述
            param2: 参数2的描述

        Returns:
            返回值的描述

        Raises:
            异常类型: 异常描述
        """
    ```

## 2. 项目结构

### 2.1 目录结构

-   保持项目结构清晰，遵循以下布局：
    ```
    ├── .python-version    # Python版本信息
    ├── .venv/             # 虚拟环境目录
    ├── .env               # 环境变量配置文件（API密钥等）
    ├── data/              # 数据存储目录
    ├── README.md          # 项目说明文档
    ├── main.py            # 主程序代码
    ├── [module_name].py   # 功能模块
    ├── pyproject.toml     # 项目配置和依赖信息
    └── uv.lock            # 依赖锁定文件
    ```

### 2.2 模块化原则

-   每个功能模块应该是独立的，有明确的职责
-   相关功能应组织在同一个模块或包中
-   避免循环导入

## 3. 编程实践

### 3.1 错误处理

-   使用 try-except 块捕获和处理异常
-   避免捕获过于宽泛的异常（如 `except Exception:`），除非有明确的错误恢复策略
-   使用日志记录异常，而不是简单地打印错误信息

### 3.2 日志记录

-   使用 Python 的 logging 模块进行日志记录
-   为每个模块创建独立的 logger
-   使用适当的日志级别：DEBUG, INFO, WARNING, ERROR, CRITICAL
-   日志消息应该清晰、具体，包含足够的上下文信息

### 3.3 配置管理

-   使用 .env 文件和 python-dotenv 库管理环境变量和配置
-   敏感信息（如 API 密钥）不应硬编码在源代码中
-   配置参数应集中管理，便于修改和维护

### 3.4 API 调用

-   为 API 请求设置超时参数
-   实现错误重试机制，特别是对于不稳定的外部 API
-   使用备用数据源或方法，以防主要 API 调用失败

## 4. 依赖管理

### 4.1 依赖声明

-   在 pyproject.toml 中声明项目依赖
-   指定依赖的版本范围，避免使用过于宽松的版本约束
-   使用 uv 工具管理依赖和虚拟环境

### 4.2 虚拟环境

-   始终在虚拟环境中开发和运行项目
-   不要将虚拟环境目录（.venv/）提交到版本控制系统

## 5. 数据处理

### 5.1 数据存储

-   使用 pandas 进行数据处理和分析
-   将数据保存为 CSV 格式，便于查看和分析
-   实现数据备份机制，防止数据丢失

### 5.2 数据验证

-   对外部获取的数据进行验证和清洗
-   处理缺失值和异常值
-   记录数据处理过程中的异常情况

## 6. 测试与质量保证

### 6.1 单元测试

-   使用 pytest 框架编写单元测试
-   为核心功能编写测试用例
-   模拟外部 API 响应，避免在测试中发送真实请求

### 6.2 代码质量工具

-   使用 ruff 进行代码风格检查
-   使用 pylint 进行静态代码分析
-   使用 black 进行代码格式化

## 7. 版本控制

### 7.1 Git 使用规范

-   使用有意义的提交消息
-   遵循语义化版本控制（Semantic Versioning）
-   使用分支进行功能开发和 bug 修复

### 7.2 敏感信息保护

-   使用 .gitignore 文件排除敏感信息和临时文件
-   不要将 .env 文件、API 密钥或其他敏感信息提交到版本控制系统
-   考虑使用环境变量或安全的密钥管理服务存储敏感信息
